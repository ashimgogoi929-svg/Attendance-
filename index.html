<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sang Fa — Attendance (No Login)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --muted:#666; --accent:#0b6efd;
    --ok:#16a34a; --bad:#dc2626; --late:#f59e0b;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  body{margin:0;background:var(--bg);color:#111;padding:12px}
  header{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  h1{margin:0;font-size:20px}
  .small{color:var(--muted);font-size:13px}
  .top{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:12px 0}
  input,textarea,select,button{font-size:14px}
  input[type=text], textarea,select{padding:8px;border-radius:8px;border:1px solid #e2e8f0;background:#fff;width:100%}
  .btn{padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer}
  .btn.ghost{background:#fff;color:var(--accent);border:1px solid #dbeafe}
  .btn.warn{background:var(--bad)}
  .layout{display:grid;grid-template-columns:1fr;gap:12px;max-width:1200px}
  .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 6px rgba(12,18,30,.04)}
  .student-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-top:10px}
  .student{padding:10px;border-radius:8px;border:1px solid #eef2ff;background:#fff;display:flex;flex-direction:column;gap:8px}
  .name{font-weight:600}
  .roll{font-size:12px;color:var(--muted)}
  .status-row{display:flex;gap:6px;align-items:center}
  .sbtn{flex:1;padding:8px;border-radius:8px;border:none;cursor:pointer}
  .present{background:var(--ok);color:#fff}
  .absent{background:var(--bad);color:#fff}
  .late{background:var(--late);color:#fff}
  .smallmuted{font-size:12px;color:var(--muted)}
  #qrPreview img{max-width:120px;border-radius:6px}
  @media (min-width:880px){
    .layout{grid-template-columns:420px 1fr}
  }
</style>
</head>
<body>

<header>
  <div>
    <h1>Sang Fa — Attendance (No Login)</h1>
    <div class="small">Multiple trainers | QR | Monthly & Fees CSV | Device assignment</div>
  </div>
</header>

<div class="top">
  <div style="display:flex;gap:8px;align-items:center;width:100%;max-width:1200px">
    <input id="trainerInput" placeholder="Type trainer/class name (e.g., Ashim Gogoi)" />
    <button id="setTrainerBtn" class="btn">Set</button>
    <select id="trainerList" style="min-width:180px"></select>
    <button id="addTrainerBtn" class="btn ghost">Add Trainer</button>
    <button id="assignDeviceBtn" class="btn ghost">Assign This Device</button>
    <button id="clearDeviceBtn" class="btn ghost">Clear Device Assign</button>
  </div>
</div>

<div class="layout">
  <div class="card">
    <strong>Add / Edit Student</strong>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
      <input id="regNo" placeholder="Registration No (e.g., R001)">
      <input id="stuName" placeholder="Student full name">
      <input id="dob" placeholder="DOB (YYYY-MM-DD)">
      <input id="father" placeholder="Father name">
      <input id="phone" placeholder="Phone (10 digit)">
      <input id="belt" placeholder="Belt Rank (White/Yellow/Blue...)">
      <input id="aadhaar" placeholder="Aadhaar (optional)">
      <select id="level"><option value="Beginner">Beginner</option><option value="Advance">Advance</option></select>
      <input id="fee" placeholder="Monthly Fee (₹)">
    </div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="addStudentBtn" class="btn">Add Student</button>
      <button id="importBtn" class="btn ghost">Import CSV</button>
      <button id="exportStudentsBtn" class="btn ghost">Export Students CSV</button>
      <button id="clearStudentsBtn" class="btn warn">Clear Students</button>
    </div>

    <hr/>
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div><strong>Saved Students</strong> <span id="studentCount" class="smallmuted">0</span></div>
      <div class="smallmuted">Click student name to edit</div>
    </div>
    <div id="savedStudents" class="student-list" style="margin-top:8px"></div>

    <hr/>
    <div>
      <strong>QR Tools</strong>
      <div style="display:flex;gap:8px;margin-top:8px">
        <select id="qrSelect" style="flex:1"></select>
        <button id="genQR" class="btn">Generate</button>
        <button id="scanQR" class="btn ghost">Scan</button>
      </div>
      <div id="qrPreview" style="margin-top:8px"></div>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="smallmuted">Class: <strong id="currentTrainer">Default</strong></div>
        <div class="smallmuted">Date: <strong id="dateText"></strong></div>
      </div>
      <div class="smallmuted">Tap to mark — or scan QR</div>
    </div>

    <div style="margin-top:12px">
      <div id="markedCount" class="smallmuted">0 marked</div>
      <div id="attendanceGrid" class="student-list" style="margin-top:8px"></div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button id="exportToday" class="btn">Export Today's CSV</button>
      <button id="saveToday" class="btn ghost">Save Today</button>
      <button id="resetBtn" class="btn ghost">Reset All to Absent</button>
      <button id="exportMonth" class="btn ghost">Export Monthly CSV</button>
      <button id="exportFees" class="btn ghost">Monthly Fees CSV</button>
    </div>

    <div style="margin-top:12px;color:var(--muted);font-size:12px">
      Tip: Add students once per trainer. Device assignment locks the device to that trainer (so trainer can't switch without clearing device).
    </div>
  </div>
</div>

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
/* Simple attendance app (no login). Data stored in localStorage.
   Keys:
   - sf_trainers  -> array of trainer names
   - sf_students_{trainer} -> array of students
   - sf_att_{trainer}_{YYYY-MM-DD} -> attendance map
   - sf_device_assign -> {deviceId: trainer}
*/

const KEY_TRAINERS = 'sf_trainers_v1';
const KEY_DEVICE = 'sf_device_assign_v1';
const PREFIX_STU = 'sf_students_';
const PREFIX_ATT = 'sf_att_';

// helpers
function nowDate(){ return new Date().toISOString().slice(0,10); }
function lsGet(k, def){ try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : def; }catch(e){ return def; } }
function lsSet(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function download(text, filename){ const b = new Blob([text], {type:'text/csv'}); const u = URL.createObjectURL(b); const a = document.createElement('a'); a.href=u; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); }

// DOM
const trainerInput = document.getElementById('trainerInput');
const setTrainerBtn = document.getElementById('setTrainerBtn');
const trainerList = document.getElementById('trainerList');
const addTrainerBtn = document.getElementById('addTrainerBtn');
const assignDeviceBtn = document.getElementById('assignDeviceBtn');
const clearDeviceBtn = document.getElementById('clearDeviceBtn');

const regNo = document.getElementById('regNo');
const stuName = document.getElementById('stuName');
const dob = document.getElementById('dob');
const father = document.getElementById('father');
const phone = document.getElementById('phone');
const belt = document.getElementById('belt');
const aadhaar = document.getElementById('aadhaar');
const level = document.getElementById('level');
const fee = document.getElementById('fee');
const addStudentBtn = document.getElementById('addStudentBtn');
const importBtn = document.getElementById('importBtn');
const exportStudentsBtn = document.getElementById('exportStudentsBtn');
const clearStudentsBtn = document.getElementById('clearStudentsBtn');

const savedStudents = document.getElementById('savedStudents');
const studentCount = document.getElementById('studentCount');
const qrSelect = document.getElementById('qrSelect');
const genQR = document.getElementById('genQR');
const scanQR = document.getElementById('scanQR');
const qrPreview = document.getElementById('qrPreview');

const currentTrainerText = document.getElementById('currentTrainer');
const dateText = document.getElementById('dateText');
const attendanceGrid = document.getElementById('attendanceGrid');
const markedCount = document.getElementById('markedCount');

const exportToday = document.getElementById('exportToday');
const saveToday = document.getElementById('saveToday');
const resetBtn = document.getElementById('resetBtn');
const exportMonth = document.getElementById('exportMonth');
const exportFees = document.getElementById('exportFees');

// state
let trainers = lsGet(KEY_TRAINERS, ['Default']);
let currentTrainer = trainers[0];
let students = []; // loaded for current trainer
let attendance = {}; // key -> status for today
let deviceAssign = lsGet(KEY_DEVICE, {});

// init
function init(){
  populateTrainers();
  setTrainer(currentTrainer);
  dateText.textContent = new Date().toLocaleString();
}
function populateTrainers(){
  trainerList.innerHTML = '';
  trainers.forEach(t => {
    const opt = document.createElement('option'); opt.value = t; opt.text = t; trainerList.appendChild(opt);
  });
}
function saveTrainers(){ lsSet(KEY_TRAINERS, trainers); populateTrainers(); }

// students
function keyStudents(tr){ return PREFIX_STU + encodeURIComponent(tr); }
function keyAttendance(tr, date){ return PREFIX_ATT + encodeURIComponent(tr) + '_' + date; }
function loadStudents(){
  students = lsGet(keyStudents(currentTrainer), []);
  renderStudentList();
}
function saveStudents(){ lsSet(keyStudents(currentTrainer), students); renderStudentList(); }

// render
function renderStudentList(){
  savedStudents.innerHTML = ''; qrSelect.innerHTML=''; studentCount.textContent = students.length + ' students';
  students.forEach((s,i)=>{
    const el = document.createElement('div'); el.className='student';
    const name = document.createElement('div'); name.className='name'; name.textContent = s.name + (s.reg||'');
    name.onclick = ()=> editStudent(i);
    const meta = document.createElement('div'); meta.className='roll'; meta.textContent = `Reg: ${s.reg || ''} • ${s.phone || ''}`;
    const row = document.createElement('div'); row.style.display='flex'; row.style.gap='6px';
    const qr = document.createElement('button'); qr.className='btn ghost'; qr.textContent='QR'; qr.onclick = ()=> genQRFor(s);
    const del = document.createElement('button'); del.className='btn warn'; del.textContent='Delete'; del.onclick = ()=> { if(confirm('Delete '+s.name+'?')){ students.splice(i,1); saveStudents(); loadAttendance(); } };
    row.appendChild(qr); row.appendChild(del);
    el.appendChild(name); el.appendChild(meta); el.appendChild(row);
    savedStudents.appendChild(el);

    const o = document.createElement('option'); o.value = s.reg || ('i'+i); o.textContent = (s.reg? s.reg+' • ':'') + s.name;
    qrSelect.appendChild(o);
  });
  renderAttendanceGrid();
}

// add / edit
function addOrUpdateStudent(){
  const obj = {
    reg: regNo.value.trim() || nextReg(),
    name: stuName.value.trim() || 'Unknown',
    dob: dob.value.trim(),
    father: father.value.trim(),
    phone: phone.value.trim(),
    belt: belt.value.trim(),
    aadhaar: aadhaar.value.trim(),
    level: level.value,
    fee: Number(fee.value) || 0
  };
  // if reg already exists, update
  const idx = students.findIndex(s=> s.reg === obj.reg);
  if(idx>=0) { students[idx] = obj; }
  else students.push(obj);
  saveStudents();
  clearForm();
  alert('Student saved.');
}
function clearForm(){ regNo.value=''; stuName.value=''; dob.value=''; father.value=''; phone.value=''; belt.value=''; aadhaar.value=''; level.value='Beginner'; fee.value=''; }
function editStudent(i){
  const s = students[i];
  regNo.value = s.reg || '';
  stuName.value = s.name || '';
  dob.value = s.dob || '';
  father.value = s.father || '';
  phone.value = s.phone || '';
  belt.value = s.belt || '';
  aadhaar.value = s.aadhaar || '';
  level.value = s.level || 'Beginner';
  fee.value = s.fee || '';
}

// simple registration generator
function nextReg(){
  let max = 0;
  students.forEach(s=>{ const m = parseInt((s.reg||'').replace(/\D/g,'')) || 0; if(m>max) max=m; });
  return 'R' + String(max+1).padStart(3,'0');
}

// attendance
function loadAttendance(){
  attendance = lsGet(keyAttendance(currentTrainer, nowDate()), {});
  renderAttendanceGrid();
}
function saveAttendance(){ lsSet(keyAttendance(currentTrainer, nowDate()), attendance); showMarkedCount(); }
function renderAttendanceGrid(){
  attendanceGrid.innerHTML = '';
  students.forEach((s,i)=>{
    const key = s.reg || ('i'+i);
    const st = attendance[key] || 'absent';
    const c = document.createElement('div'); c.className='student';
    const n = document.createElement('div'); n.className='name'; n.textContent = s.name;
    const r = document.createElement('div'); r.className='roll'; r.textContent = `${s.reg || ''} • ${s.level || ''}`;
    const stRow = document.createElement('div'); stRow.className='status-row';
    const b1 = document.createElement('button'); b1.className='sbtn present'; b1.textContent='Present';
    const b2 = document.createElement('button'); b2.className='sbtn absent'; b2.textContent='Absent';
    const b3 = document.createElement('button'); b3.className='sbtn late'; b3.textContent='Late';
    [b1,b2,b3].forEach(btn=> btn.style.opacity = '0.6');
    if(st==='present') b1.style.opacity='1';
    if(st==='absent') b2.style.opacity='1';
    if(st==='late') b3.style.opacity='1';
    b1.onclick = ()=>{ attendance[key] = 'present'; saveAttendance(); renderAttendanceGrid(); };
    b2.onclick = ()=>{ attendance[key] = 'absent'; saveAttendance(); renderAttendanceGrid(); };
    b3.onclick = ()=>{ attendance[key] = 'late'; saveAttendance(); renderAttendanceGrid(); };
    stRow.appendChild(b1); stRow.appendChild(b2); stRow.appendChild(b3);
    c.appendChild(n); c.appendChild(r); c.appendChild(stRow);
    attendanceGrid.appendChild(c);
  });
  showMarkedCount();
}
function showMarkedCount(){ const total = students.length; const marked = Object.keys(attendance).length; markedCount.textContent = `${marked} marked / ${total} total`; }

// export CSVs
function exportTodayCSV(){
  const rows = ['trainer,date,reg,name,status'];
  students.forEach((s,i)=>{
    const key = s.reg || ('i'+i);
    const st = attendance[key] || 'absent';
    rows.push([currentTrainer, new Date().toISOString(), s.reg, `"${s.name.replace(/"/g,'""')}"`, st].join(','));
  });
  download(rows.join('\\n'), `${currentTrainer}_attendance_${nowDate()}.csv`);
}
function exportMonthlyCSV(){
  const now = new Date(); const year = now.getFullYear(); const month = now.getMonth()+1;
  const rows = ['reg,name,present,absent,late,total,percent'];
  students.forEach((s,i)=>{
    const key = s.reg || ('i'+i);
    let present=0, absent=0, late=0, total=0;
    const days = new Date(year, month, 0).getDate();
    for(let d=1; d<=days; d++){
      const dateStr = `${year}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const dayAtt = lsGet(keyAttendance(currentTrainer, dateStr), {});
      const st = dayAtt[key];
      if(st){ total++; if(st==='present') present++; else if(st==='absent') absent++; else if(st==='late') late++; }
    }
    const pct = total? Math.round((present/total)*100) : 0;
    rows.push([s.reg, `"${s.name.replace(/"/g,'""')}"`, present, absent, late, total, pct].join(','));
  });
  download(rows.join('\\n'), `${currentTrainer}_monthly_${year}_${String(month).padStart(2,'0')}.csv`);
}
function exportMonthlyFeesCSV(){
  const now = new Date(); const year = now.getFullYear(); const month = now.getMonth()+1;
  const rows = ['reg,name,monthly_fee'];
  students.forEach(s=>{
    rows.push([s.reg, `"${s.name.replace(/"/g,'""')}"`, s.fee || 0].join(','));
  });
  download(rows.join('\\n'), `${currentTrainer}_fees_${year}_${String(month).padStart(2,'0')}.csv`);
}

// QR gen/scan
async function genQRFor(s){
  const data = `sf:${currentTrainer}:${s.reg || ''}`;
  try{
    const url = await QRCode.toDataURL(data, {width:300});
    qrPreview.innerHTML = '';
    const img = document.createElement('img'); img.src = url; img.alt='qr';
    const a = document.createElement('a'); a.href = url; a.download = `${(s.reg||s.name)}_qr.png`; a.className='btn'; a.textContent='Download';
    qrPreview.appendChild(img); qrPreview.appendChild(document.createElement('br')); qrPreview.appendChild(a);
  }catch(e){ alert('QR error'); }
}
genQR.addEventListener('click', ()=>{
  const idx = qrSelect.selectedIndex;
  if(idx<0) return alert('Select student');
  const s = students[idx];
  genQRFor(s);
});

// scanning using camera
let scanning = false; let videoStream = null;
scanQR.addEventListener('click', async ()=>{
  if(scanning){ stopScan(); return; }
  if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return alert('Camera not supported.');
  const video = document.createElement('video'); video.setAttribute('playsinline','true'); video.style.width='100%';
  qrPreview.innerHTML = ''; qrPreview.appendChild(video);
  scanning = true; scanQR.textContent = 'Stop Scan';
  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
    video.srcObject = stream; video.play(); videoStream = stream;
    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
    const tick = ()=>{
      if(video.readyState === video.HAVE_ENOUGH_DATA){
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        ctx.drawImage(video,0,0,canvas.width,canvas.height);
        try{
          const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
          const code = jsQR(imgData.data, imgData.width, imgData.height);
          if(code){
            const data = code.data; stopScan(); processQR(data); return;
          }
        }catch(e){}
      }
      if(scanning) requestAnimationFrame(tick);
    };
    requestAnimationFrame(tick);
  }catch(e){ scanning=false; scanQR.textContent='Scan'; alert('Camera error or permission denied'); }
});
function stopScan(){ scanning=false; scanQR.textContent='Scan'; if(videoStream){ videoStream.getTracks().forEach(t=>t.stop()); videoStream=null; } qrPreview.innerHTML=''; }

function processQR(data){
  if(!data.startsWith('sf:')) return alert('Unknown QR');
  const parts = data.split(':'); const cls = parts[1] || currentTrainer; const reg = parts[2] || '';
  if(cls !== currentTrainer){
    if(!confirm(`QR is for class "${cls}". Switch and mark?`)) return;
    setTrainer(cls);
  }
  const idx = students.findIndex(s=> s.reg === reg);
  if(idx>=0){ attendance[reg] = 'present'; saveAttendance(); renderAttendanceGrid(); alert(students[idx].name + ' marked Present.'); }
  else alert('Student not found: ' + reg);
}

// device assignment (no PIN)
function deviceId(){ return navigator.userAgent + '|' + (screen.width || 0) + 'x' + (screen.height||0); }
function assignDevice(){
  deviceAssign = lsGet(KEY_DEVICE, {});
  deviceAssign[deviceId()] = currentTrainer;
  lsSet(KEY_DEVICE, deviceAssign);
  alert('Device assigned to ' + currentTrainer);
}
function clearDevice(){
  deviceAssign = lsGet(KEY_DEVICE, {});
  delete deviceAssign[deviceId()];
  lsSet(KEY_DEVICE, deviceAssign);
  alert('Device cleared');
}
function checkDeviceLock(){
  deviceAssign = lsGet(KEY_DEVICE, {});
  const assigned = deviceAssign[deviceId()];
  if(assigned && assigned !== currentTrainer){
    // lock UI switching - we force currentTrainer to assigned
    alert('This device is assigned to "'+assigned+'". Switching back to that trainer.');
    setTrainer(assigned);
  }
}

// trainer set
function setTrainer(t){
  if(!t) return;
  currentTrainer = t;
  currentTrainerText.textContent = currentTrainer;
  trainerInput.value = '';
  // ensure trainer in list
  if(!trainers.includes(t)){ trainers.push(t); saveTrainers(); }
  loadStudents();
  loadAttendance();
  checkDeviceLock();
}
setTrainerBtn.addEventListener('click', ()=> {
  const v = trainerInput.value.trim(); if(!v) return alert('Type trainer name'); setTrainer(v);
});
addTrainerBtn.addEventListener('click', ()=>{
  const v = trainerInput.value.trim(); if(!v) return alert('Type trainer name'); if(!trainers.includes(v)) { trainers.push(v); saveTrainers(); alert('Trainer added'); }
  trainerInput.value='';
});
trainerList.addEventListener('change', ()=> {
  const v = trainerList.value; if(v) setTrainer(v);
});

// save/load
addStudentBtn.addEventListener('click', addOrUpdateStudent);
exportStudentsBtn.addEventListener('click', ()=>{
  if(students.length===0) return alert('No students');
  const rows = ['reg,name,dob,father,phone,belt,aadhaar,level,fee'];
  students.forEach(s=> rows.push([s.reg, `"${s.name.replace(/"/g,'""')}"`, s.dob || '', `"${(s.father||'').replace(/"/g,'""')}"`, s.phone || '', s.belt || '', s.aadhaar || '', s.level || '', s.fee || 0].join(',')));
  download(rows.join('\\n'), `${currentTrainer}_students.csv`);
});
clearStudentsBtn.addEventListener('click', ()=> { if(!confirm('Delete all students for this trainer?')) return; students=[]; saveStudents(); loadAttendance(); });

importBtn.addEventListener('click', ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='.csv,text/csv';
  input.onchange = e => {
    const f = e.target.files[0]; if(!f) return;
    const r = new FileReader(); r.onload = ev => {
      const txt = ev.target.result; const lines = txt.split(/\\r?\\n/).map(l=>l.trim()).filter(Boolean);
      // expect header or simple name,reg
      lines.forEach((ln, idx) => {
        if(idx===0 && ln.toLowerCase().includes('reg')) return; // skip header
        const parts = ln.split(',').map(p=>p.trim().replace(/^"|"$/g,''));
        const s = { reg: parts[0] || nextReg(), name: parts[1]||parts[0]||'Unknown', dob: parts[2]||'', father: parts[3]||'', phone: parts[4]||'', belt: parts[5]||'', aadhaar: parts[6]||'', level: parts[7]||'Beginner', fee: Number(parts[8]||0) };
        if(s.name) students.push(s);
      });
      saveStudents(); alert('Import complete');
    }; r.readAsText(f);
  };
  input.click();
});

// exports
exportToday.addEventListener('click', exportTodayCSV);
exportMonth.addEventListener('click', exportMonthlyCSV);
exportFees.addEventListener('click', exportMonthlyFeesCSV);
saveToday.addEventListener('click', ()=> { saveAttendance(); alert('Saved'); });
resetBtn.addEventListener('click', ()=> {
  if(!confirm('Set all to Absent for today?')) return;
  attendance = {};
  students.forEach((s,i)=> attendance[s.reg || ('i'+i)] = 'absent');
  saveAttendance(); renderAttendanceGrid();
});

// device assign
assignDeviceBtn.addEventListener('click', assignDevice);
clearDeviceBtn.addEventListener('click', clearDevice);

// on load
window.addEventListener('load', init);
window.addEventListener('storage', ()=> { trainers = lsGet(KEY_TRAINERS, ['Default']); populateTrainers(); if(currentTrainer) loadStudents(); loadAttendance(); });

</script>
</body>
</html>
